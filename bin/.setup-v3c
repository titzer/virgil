#!/bin/bash

SOURCE=${BASH_SOURCE[0]}
HERE=$(command dirname $SOURCE)
. $HERE/funcs.bash
# set DIR to true directory containing this file
follow_links $SOURCE
BIN=$DIR
[[ $BIN != /* ]] && [[ $BIN != ./* ]] && BIN=./$BIN

V3C_LINK=$BIN/v3c
HOSTS=$($BIN/dev/sense_host)

for host in $HOSTS; do
    for f in current bootstrap stable; do
	exe=$BIN/$f/$host/Aeneas
	if [ -x $exe ]; then
	    if [ "$(which git)" != "" ]; then
		git update-index --assume-unchanged $V3C_LINK
	    fi
	    rm -f $V3C_LINK
	    ln -s $exe $V3C_LINK
	    if [[ "$host" = jar ]]; then
		rm -f $BIN/Aeneas.jar
		ln -s $BIN/$f/jar/Aeneas.jar $BIN/Aeneas.jar
	    fi
	    exit 0
	fi
    done
done

echo "setup-v3c: no binaries found for any host in {$HOSTS}."
exit 1
